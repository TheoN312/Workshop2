# Предсказание повторных покупок в интернет-магазине

## Описание проекта

Интернет-магазин собирает историю покупателей, проводит рассылки предложений и планирует будущие продажи. Для оптимизации процессов надо выделить пользователей, которые готовы совершить покупку в ближайшее время.

### Цель

Предсказать вероятность покупки в течение 90 дней.

### Задачи

- Изучить данные
- Разработать полезные признаки
- Создать модель для классификации пользователей
- Улучшить модель и максимизировать метрику roc_auc
- Выполнить тестирование

## Описание данных

### `apparel-purchases`

История покупок клиентов по дням и по товарам. В каждой записи покупка определенной группы товаров, его цена, количество штук.

- `client_id` — идентификатор клиента,
- `quantity` — количество единиц товара,
- `price` — цена товара,
- `category_ids` — идентификаторы категорий,
- `date` — дата покупки,
- `message_id` — идентификатор сообщения из рассылки.

### `apparel-messages`

История рекламных рассылок, которые были отправлены клиентам из таблицы покупок.

- `bulk_campaign_id` — идентификатор рассылки,
- `client_id` — идентификатор клиента,
- `message_id` — идентификатор сообщения,
- `event` — действие с сообщением (отправлено, открыто, покупка …),
- `channel` — канал рассылки,
- `date` — дата действия,
- `created_at` — точное время создания сообщения.

### `apparel-target_binary`

Бинарное значение совершит ли клиент покупку в течение следующих 90 дней.
- `client_id` — идентификатор клиента,
- `target` — клиент совершил повторную покупку в целевом периоде.

## Загрузка данных

### `apparel-purchases`

Создан датафрейм `purch`, содержащий в себе данные о покупках клиентов по дням и по товарам. Он имеет 6 столбцов и 202 208 строк. При этом столбцы имеют следующий характер:

- `client_id` — идентификатор клиента. Имеет тип `int64`;
- `quantity` — количество единиц товара. Имеет тип `int64`.
- `price` — цена товара. Имеет тип `float64`.
- `category_ids` — идентификаторы категорий. Имеет тип `object`.
- `date` — дата покупки. Имеет тип `object`.
- `message_id` — идентификатор сообщения из рассылки. Имеет тип `object`.

### `apparel-messages`

Создан датафрейм `mess`, содержащий в себе данные о рассылках, которые были отправлены клиентам из таблицы покупок. Он имеет 7 столбцов и 12 739 798 строк. При этом столбцы имеют следующий характер:

- `bulk_campaign_id` — идентификатор рассылки. Имеет тип `int64`;
- `client_id` — идентификатор клиента. Имеет тип `int64`;
- `message_id` — идентификатор сообщения. Имеет тип `object`;
- `event` — действие с сообщением (отправлено, открыто, покупка …). Имеет тип `object`;
- `channel` — канал рассылки. Имеет тип `object`;
- `date` — дата действия. Имеет тип `object`;
- `created_at` — точное время создания сообщения. Имеет тип `object`.

### `target`

Создан датафрейм `target`, содержащий в себе данные о совершении покупок клиентами в целевой период. Он имеет 2 столбца и 49 849 строк. При этом столбцы имеют следующий характер:

- `client_id` — идентификатор клиента. Имеет тип `int64`;
- `target` — клиент совершил повторную покупку в целевом периоде. Имеет тип `int64`.

### `full_campaign_daily_event`

Создан датафрейм 'fcde', 24 столбца и 131 072 строки.

### `full_campaign_daily_event_channel`

Создан датафрейм 'fcdeс', 36 столбцов и 131 071 строка.

## Предобработка данных

##### apparel-purchases
Преобразован тип данных у признаков с датами. Удалены явные дубликаты. Преобразован параметр отвечающий за категории.

##### apparel-messages
Преобразован тип данных у признаков с датами. Удалены явные дубликаты.

##### target
Отклонений не зафиксировано.

##### full_campaign_daily_event
Отклонений не зафиксировано.

##### full_campaign_daily_event_channel
Отклонений не зафиксировано.

## Исследовательский анализ данных

Основные пики клиентских покупок: период с ноября по декабрь (предновогодние праздники) и середина лета (закупки к школам, институтма и сезон гуляний по улице). Предпочитают небольшое кол-во товаров (до 3-ех товаров). И ценой не более 7 тыс. рублей. По кодам товара наибольшей популярностью пользуется: 4, 2, 5562. Клиенты предпочитают больше пуш-сообщения на мобильный телефон.

## Объединение данных

Объединили два файла в единую таблицу. Вывели отношение покупок от рассылок.

## Создание нового признака

Создали и добавили новый признак, который показывает: произошла покупка после события или нет.

## Корреляционный анализ данных

Добавили файл target в общую таблицу, провели корреляционный анализ. Сильных взаимосвязей не обнаружили.

## Обучение модели

Обучили три модели: RandomForestClassifier, CatBoostClassifier и LGBMClassifier. Наилучшую точность показала: RandomForestClassifier. Метрика ROC-AUC на тестовой выборке составил ~0,8.


### Анализ важности признаков

В рамках анализа важности признаков выявили, что в основном влияте:
- Цена товара;
- Получение рассылки;
- Категория товара.

Отсюда можно сделать вывод, что клиентам важно получать информацию о скидочных предложениях на сезонный товар в любых каналах обслуживания. Стоит уделять большее время летнем переоду, когда клиенты начинают интересоваться подготовкой к школам и вузам, а также предновогоднее время, когда люди готовятся к праздникам.
